<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>FresnelTest</title>
    <style>
        body {
            margin: 0;
        }
    </style>
</head>

<body style="margin: 0;overflow: hidden;">
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@0.150.1/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.150.1/examples/jsm/"
          }
        }
      </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        // import { AsciiEffect } from 'three/addons/effects/AsciiEffect.js';

        // const scene = new THREE.Scene();

        // const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        // camera.position.set(0, 0, 0);
        // scene.add(camera);

        // const loader = new GLTFLoader();
        // const shaderloader = new THREE.FileLoader();
        // let material = new THREE.ShaderMaterial( {
        // 	vertexShader: THREE.FresnelShader.vertexShader,
        // 	fragmentShader: THREE.FresnelShader.fragmentShader
        // });

        // const renderer = new THREE.WebGLRenderer();
        // renderer.setSize(window.innerWidth, window.innerHeight);
        // document.body.appendChild(renderer.domElement);

        // const pointLight = new THREE.PointLight(0xffffff, 1);
        // pointLight.position.set(0, 10, 0);
        // pointLight.castShadow = true;
        // scene.add(pointLight);

        // const planeGeometry = new THREE.PlaneGeometry(10, 10);
        // const planeMaterial = new THREE.MeshStandardMaterial({ color: 0x303030 });
        // const plane = new THREE.Mesh(planeGeometry, planeMaterial);
        // plane.rotation.x = -Math.PI / 2;
        // plane.position.y = -1.25
        // plane.castShadow = false;
        // plane.receiveShadow = true;
        // scene.add(plane);

        // let shader = THREE.FresnelShader = {

        //     uniforms: {},

        //     vertexShader: [

        //         "varying vec3 vPositionW;",
        //         "varying vec3 vNormalW;",

        //         "void main() {",

        //         "	vPositionW = vec3( vec4( position, 1.0 ) * modelMatrix);",
        //         " vNormalW = normalize( vec3( vec4( normal, 0.0 ) * modelMatrix ) );",

        //         "	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

        //         "}"

        //     ].join("\n"),

        //     fragmentShader: [

        //         "varying vec3 vPositionW;",
        //         "varying vec3 vNormalW;",

        //         "void main() {",

        //         "	vec3 color = vec3(1., 1., 1.);",
        //         "	vec3 viewDirectionW = normalize(cameraPosition - vPositionW);",
        //         "	float fresnelTerm = dot(viewDirectionW, vNormalW);",
        //         "	fresnelTerm = clamp(1.0 - fresnelTerm, 0., 1.);",

        //         "	gl_FragColor = vec4( color * fresnelTerm, 1.);",

        //         "}"

        //     ].join("\n")

        // };

        // let model
        // let effect

        // loader.load('./threeJS/FresnelTest.gltf', function (gltf) {
        //     model = gltf.scene;
        //     model.scale.set(0.8, 0.8, 0.8);
        //     model.position.set(0, 0, 0);
        //     // model.traverse(function (node) {
        //     //     if (node.isMesh) {
        //     //         node.material.wireframe = true; // make the material wireframe
        //     //     }
        //     // });
        //     model.ShaderMaterial = material
        //     model.castShadow = true

        //     scene.add(model);
        // }, undefined, function (error) {
        //     console.error(error);
        // });

        // const controls = new OrbitControls(camera, renderer.domElement);

        // camera.position.z = 5;

        // const animate = () => {

        //     requestAnimationFrame(animate);
        //     if (model || material) {
        //         // model.rotation.x += -0.01;
        //         // model.rotation.y += 0.01;
        //     }
        //     renderer.render(scene, camera);
        // }

        // animate()

        let material = THREE.extendMaterial(THREE.FresnelShader, {

            uniforms: {},

            vertexShader: [

                "varying vec3 vPositionW;",
                "varying vec3 vNormalW;",

                "void main() {",

                "	vPositionW = vec3( vec4( position, 1.0 ) * modelMatrix);",
                " vNormalW = normalize( vec3( vec4( normal, 0.0 ) * modelMatrix ) );",

                "	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

                "}"

            ].join("\n"),

            fragmentShader: [

                "varying vec3 vPositionW;",
                "varying vec3 vNormalW;",

                "void main() {",

                "	vec3 color = vec3(1., 1., 1.);",
                "	vec3 viewDirectionW = normalize(cameraPosition - vPositionW);",
                "	float fresnelTerm = dot(viewDirectionW, vNormalW);",
                "	fresnelTerm = clamp(1.0 - fresnelTerm, 0., 1.);",

                "	gl_FragColor = vec4( color * fresnelTerm, 1.);",

                "}"

            ].join("\n")

        })


        var camera, scene, renderer;
        var geometry, material, mesh;

        init();
        animate();

        function init() {

            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 10);
            camera.position.z = 5;

            scene = new THREE.Scene();

            geometry = new THREE.TorusKnotBufferGeometry(1, 0.3, 128, 16);
            

            mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);


        }

        function animate() {

            requestAnimationFrame(animate);

            renderer.render(scene, camera);
        }
    </script>
    <div id="note" style="color: white; background-color: black;">Drag to Rotate</div>
</body>

</html>